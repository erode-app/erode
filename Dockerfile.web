# Stage 1: Build
FROM node:24-slim AS builder
WORKDIR /app

COPY package.json package-lock.json ./
COPY packages/web/package.json packages/web/
COPY packages/core/package.json packages/core/
COPY packages/eslint-config/package.json packages/eslint-config/

# Lockfile records macOS-specific rollup binaries; npm ci/install
# won't resolve the correct linux native binary (npm#4828).
# Deleting the lockfile lets npm resolve platform deps fresh.
RUN rm package-lock.json && npm install

COPY packages/web/ packages/web/
RUN npm run build --workspace=packages/web

# Stage 2: Serve static files
FROM nginx:alpine
COPY --from=builder /app/packages/web/dist/ /usr/share/nginx/html/
EXPOSE 80
